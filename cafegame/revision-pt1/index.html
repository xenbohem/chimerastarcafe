<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chimera Café</title>
<style>
    body {
        margin:0;
        font-family:'Georgia','serif';
        background: linear-gradient(to bottom, #1b0b2f, #3d1f5e);
        color:#eee;
        overflow-x:hidden;
    }

    /* TILES GRID */
    #tilesGrid {
        display:grid;
        grid-template-columns:repeat(6,1fr);
        grid-gap:2px;
        width:100vw;
        height:100vh;
    }
    .tile {
        position:relative;
        background:#222;
        overflow:hidden;
        cursor:pointer;
        transition:all 0.3s ease;
    }
    .tile img {
        width:100%;
        height:100%;
        object-fit:cover;
        filter:blur(1px);
        transition:filter 0.3s ease;
    }
    .tile:hover img { filter:blur(0); }

    /* POPUP STYLES */
    .popupBG, .chatBox, #musicRoom, #cafeMenu, #enlightenmentRealm {
        display:none;
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.85);
        z-index:1000;
        justify-content:center;
        align-items:center;
        overflow:auto;
    }
    .popupWindow, .chatContent, #musicRoomBox, #cafeMenuBox, #enlightenmentBox {
        background:rgba(30,0,60,0.95);
        padding:20px;
        border-radius:10px;
        color:#eee;
        max-width:500px;
        width:90%;
    }
    button { margin:5px; padding:8px 12px; border:none; border-radius:4px; cursor:pointer; }

    /* INVENTORY */
    #inventoryDrawer {
        position:fixed;
        right:-360px;
        top:0;
        width:360px;
        height:100%;
        background:linear-gradient(to bottom, #220a33, #3d1f5e);
        color:#fff;
        transition:right 0.5s ease;
        padding:10px;
        z-index:1200;
        overflow:auto;
    }
    #umbrellaRune {
        position:fixed;
        top:10px;
        right:370px;
        width:50px;
        height:50px;
        background-size:cover;
        cursor:pointer;
        transition:all 0.3s ease;
        z-index:1300;
    }
    .umbrellaOpen { transform:rotate(180deg); }

    /* INVENTORY ITEMS */
    .invItem { border-bottom:1px solid #444; margin:5px 0; padding:3px; }

    /* LOGIN */
    #loginScreen { display:flex; position:fixed; inset:0; justify-content:center; align-items:center; background:rgba(0,0,0,0.9); flex-direction:column; z-index:2000; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
    <h1>Chimera Café</h1>
    <input type="text" id="usernameInput" placeholder="Enter Gamer Name">
    <button onclick="loginUser()">Login</button>
</div>
<button id="logoutBtn" onclick="logoutUser()" style="display:none;position:fixed;top:10px;left:10px;">Logout</button>

<!-- INVENTORY -->
<div id="inventoryDrawer">
    <h3>Your Drawer</h3>
    <div id="inventoryContent"></div>
</div>
<div id="umbrellaRune" onclick="toggleInventory()"></div>

<!-- TILES GRID -->
<div id="tilesGrid">
    <!-- 36 tiles -->
    <div class="tile" data-id="1" onclick="tileAction(1)"></div>
    <div class="tile" data-id="2" onclick="tileAction(2)"></div>
    <div class="tile" data-id="3" onclick="tileAction(3)"></div>
    <div class="tile" data-id="4" onclick="tileAction(4)"></div>
    <div class="tile" data-id="5" onclick="tileAction(5)"></div>
    <div class="tile" data-id="6" onclick="tileAction(6)"></div>
    <div class="tile" data-id="7" onclick="tileAction(7)"></div>
    <div class="tile" data-id="8" onclick="tileAction(8)"></div>
    <div class="tile" data-id="9" onclick="tileAction(9)"></div>
    <div class="tile" data-id="10" onclick="tileAction(10)"></div>
    <div class="tile" data-id="11" onclick="tileAction(11)"></div>
    <div class="tile" data-id="12" onclick="tileAction(12)"></div>
    <div class="tile" data-id="13" onclick="tileAction(13)"></div>
    <div class="tile" data-id="14" onclick="tileAction(14)"></div>
    <div class="tile" data-id="15" onclick="tileAction(15)"></div>
    <div class="tile" data-id="16" onclick="tileAction(16)"></div>
    <div class="tile" data-id="17" onclick="tileAction(17)"></div>
    <div class="tile" data-id="18" onclick="tileAction(18)"></div>
    <div class="tile" data-id="19" onclick="tileAction(19)"></div>
    <div class="tile" data-id="20" onclick="tileAction(20)"></div>
    <div class="tile" data-id="21" onclick="tileAction(21)"></div>
    <div class="tile" data-id="22" onclick="tileAction(22)"></div>
    <div class="tile" data-id="23" onclick="tileAction(23)"></div>
    <div class="tile" data-id="24" onclick="tileAction(24)"></div>
    <div class="tile" data-id="25" onclick="tileAction(25)"></div>
    <div class="tile" data-id="26" onclick="tileAction(26)"></div>
    <div class="tile" data-id="27" onclick="tileAction(27)"></div>
    <div class="tile" data-id="28" onclick="tileAction(28)"></div>
    <div class="tile" data-id="29" onclick="tileAction(29)"></div>
    <div class="tile" data-id="30" onclick="tileAction(30)"></div>
    <div class="tile" data-id="31" onclick="tileAction(31)"></div>
    <div class="tile" data-id="32" onclick="tileAction(32)"></div>
    <div class="tile" data-id="33" onclick="tileAction(33)"></div>
    <div class="tile" data-id="34" onclick="tileAction(34)"></div>
    <div class="tile" data-id="35" onclick="tileAction(35)"></div>
    <div class="tile" data-id="36" onclick="tileAction(36)"></div>
</div>

<!-- POPUPS -->
<div class="popupBG" id="popupWrapper"><div class="popupWindow" id="popupWindow"></div></div>

<!-- CHATBOXES -->
<div class="chatBox" id="starChat"><div class="chatContent" id="starChatBox"></div></div>
<div class="chatBox" id="hansChat"><div class="chatContent" id="hansChatBox"></div></div>
<div class="chatBox" id="miloChat"><div class="chatContent" id="miloChatBox"></div></div>
<div class="chatBox" id="mikiChat"><div class="chatContent" id="mikiChatBox"></div></div>
<div class="chatBox" id="chariChat"><div class="chatContent" id="chariChatBox"></div></div>

<!-- MUSIC ROOM -->
<div class="popupBG" id="musicRoom"><div id="musicRoomBox"></div></div>

<!-- CAFE MENU -->
<div class="popupBG" id="cafeMenu"><div id="cafeMenuBox"></div></div>

<!-- ENLIGHTENMENT -->
<div class="popupBG" id="enlightenmentRealm"><div id="enlightenmentBox"></div></div>

<script>
/* ======================================================
    EMBEDDED ASSETS — Base64
====================================================== */
const umbrellaClosed = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const umbrellaOpen = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const velvetBG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";

const starImg = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const hansImg = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const miloImg = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const mikiImg = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const chariImg = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";

const lavenderSprigIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const matchaLeafIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";
const nightfallDustIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIA...";

/* AUDIO */
const windChimeBase64 = "data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU2LjI0LjEwMAAAAAAAAAC...";
let windChime = new Audio(windChimeBase64);
windChime.volume = 0.4;

/* ======================================================
    GLOBAL GAME STATE
====================================================== */
let gameState = {
    loggedIn: false,
    username: "",
    mute:false,
    volume:0.4,
    progress:{
        metStar:false,
        metHans:false,
        metMilo:false,
        solvedMiki:false,
        metChari:false,
        unlockedMusic:false,
        unlockedEnlightenment:false,
        inventory:[],
        codex:[]
    }
};

/* ======================================================
    SAVE / LOAD
====================================================== */
function saveGame(){ localStorage.setItem("chimeraCafeSave", JSON.stringify(gameState)); }
function loadGame(){ let data = localStorage.getItem("chimeraCafeSave"); if(data){ try{gameState = JSON.parse(data);}catch(e){} } }
loadGame();

/* ======================================================
    LOGIN / LOGOUT
====================================================== */
function loginUser(){
    let name = document.getElementById("usernameInput").value.trim();
    if(!name) return;
    gameState.loggedIn = true;
    gameState.username = name;
    saveGame();
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("logoutBtn").style.display="inline-block";
}
function logoutUser(){ localStorage.removeItem("chimeraCafeSave"); location.reload(); }

/* ======================================================
    SOUND / CHIME
====================================================== */
function playChime(){ if(!gameState.mute){ windChime.currentTime=0; windChime.play(); } }
function toggleMute(){ gameState.mute = !gameState.mute; saveGame(); }

/* ======================================================
    INVENTORY / UMBRELLA
====================================================== */
let runeEl = document.getElementById("umbrellaRune");
runeEl.style.backgroundImage = `url(${umbrellaClosed})`;
function toggleInventory(){
    let drawer = document.getElementById("inventoryDrawer");
    playChime();
    if(drawer.style.right==="0px"){ drawer.style.right="-360px"; runeEl.style.backgroundImage = `url(${umbrellaClosed})`; }
    else{ drawer.style.right="0px"; runeEl.style.backgroundImage = `url(${umbrellaOpen})`; refreshInventory(); }
}
function addItem(name,desc){ gameState.progress.inventory.push({name,desc}); saveGame(); refreshInventory(); }
function refreshInventory(){ let cont = document.getElementById("inventoryContent"); cont.innerHTML=""; gameState.progress.inventory.forEach(it=>{cont.innerHTML+=`<div class="invItem"><b>${it.name}</b><br>${it.desc}</div>`;}); }

/* ======================================================
    THUMBNAILS
====================================================== */
const thumbnails = {
    star: starImg, hans:hansImg, milo:miloImg, miki:mikiImg, chari:chariImg,
    cafe: velvetBG, cafeInterior: velvetBG, loreHall: velvetBG, musicDoor: velvetBG,
    clue1: velvetBG, clue2: velvetBG, clue3: velvetBG, clue4: velvetBG
};
function assignThumbnails(){
    let tiles = document.querySelectorAll(".tile");
    tiles.forEach(t=>{ let id = t.getAttribute("data-id"); t.innerHTML=`<img src="images/default${id}.jpg">`; });
    document.querySelector('.tile[data-id="3"]').innerHTML=`<img src="${thumbnails.hans}">`;
    document.querySelector('.tile[data-id="1"]').innerHTML=`<img src="${thumbnails.star}">`;
    document.querySelector('.tile[data-id="7"]').innerHTML=`<img src="${thumbnails.milo}">`;
    document.querySelector('.tile[data-id="9"]').innerHTML=`<img src="${thumbnails.miki}">`;
    document.querySelector('.tile[data-id="12"]').innerHTML=`<img src="${thumbnails.chari}">`;
    document.querySelector('.tile[data-id="18"]').innerHTML=`<img src="${thumbnails.cafe}">`;
    document.querySelector('.tile[data-id="19"]').innerHTML=`<img src="${thumbnails.cafeInterior}">`;
    document.querySelector('.tile[data-id="6"]').innerHTML=`<img src="${thumbnails.musicDoor}">`;
    document.querySelector('.tile[data-id="22"]').innerHTML=`<img src="${thumbnails.clue1}">`;
    document.querySelector('.tile[data-id="23"]').innerHTML=`<img src="${thumbnails.clue2}">`;
    document.querySelector('.tile[data-id="24"]').innerHTML=`<img src="${thumbnails.clue3}">`;
    document.querySelector('.tile[data-id="25"]').innerHTML=`<img src="${thumbnails.clue4}">`;
}
assignThumbnails();

/* ======================================================
    TILE ACTION ROUTER
====================================================== */
function tileAction(id){
    playChime();
    switch(id){
        case 1: openStarChat(); break;
        case 3: openHansChat(); break;
        case 7: openMiloChat(); break;
        case 9: openMikiChat(); break;
        case 12: openChariChat(); break;
        case 18: openCafeMenu(); break;
        case 19: openCafeMenu(); break;
        case 6: tryMusicRoom(); break;
        case 22: case 23: case 24: case 25: openPopup("Clue","<p>The air hums... someone is watching. Look for the tea snob.</p>"); break;
        default: openPopup("Tile","<p>This square whispers secrets, but not yet...</p>");
    }
}

/* ======================================================
    POPUP
====================================================== */
function openPopup(title,html){ let wrap=document.getElementById("popupWrapper"); let win=document.getElementById("popupWindow"); win.innerHTML=`<h2>${title}</h2>${html}<br><button onclick="closePopup()">Close</button>`; wrap.style.display="flex"; }
function closePopup(){ document.getElementById("popupWrapper").style.display="none"; }

/* ======================================================
    CHAT / CAFE / MUSIC LOGIC
    - Includes Hans, Star, Milo, Miki, Chari
    - Music Room & Cafe
====================================================== */

/* -- omitted here for brevity, same as Part 3 JS -- */
/* You would paste the full JS code for chats, riddle, enlightenment, music room, cafe menu, etc. here */

</script>
</body>
</html>
