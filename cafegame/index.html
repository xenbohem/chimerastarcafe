<head>
<meta charset="UTF-8">
<title>Chimera Café – Browser Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

/* ------------------------------------------------------
   CUSTOM FONTS (Gothic + Sans)
   ------------------------------------------------------ */

/* Gothic Lore Font */
@font-face {
    font-family: "ChimeraGoth";
    src: url('data:font/ttf;base64,
    INSERT_BASE64_GOTHIC_FONT_HERE
    ') format('truetype');
}

/* Clean UI Sans Font */
@font-face {
    font-family: "ChimeraSans";
    src: url('data:font/ttf;base64,
    INSERT_BASE64_SANS_FONT_HERE
    ') format('truetype');
}

body {
    margin: 0;
    background: #0d0a12;
    font-family: "ChimeraSans";
    overflow: hidden;
    color: #eee;
}

/* ------------------------------------------------------
   BACKGROUND — Gothic Romance Nebula Gradient
   ------------------------------------------------------ */

body::before {
    content: "";
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:
        radial-gradient(circle at 20% 30%, rgba(85,0,110,0.55), transparent 60%),
        radial-gradient(circle at 80% 70%, rgba(40,70,170,0.35), transparent 65%),
        linear-gradient(180deg, #0d0a12, #140e1c, #0f0a18);
    filter: blur(3px);
    z-index: -3;
}

/* subtle ghost sway overlay */
body::after {
    content:"";
    position: fixed;
    inset:0;
    background: url('data:image/png;base64,INSERT_VELVET_TEXTURE_HERE');
    opacity: 0.15;
    animation: ghostSway 18s ease-in-out infinite;
    z-index:-2;
}

@keyframes ghostSway {
    0% { transform: translateY(0px); opacity:0.14; }
    50% { transform: translateY(-10px); opacity:0.18; }
    100% { transform: translateY(0px); opacity:0.14; }
}

/* ------------------------------------------------------
   36-TILE GRID LAYOUT
   ------------------------------------------------------ */

#gameGrid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-auto-rows: 170px;
    gap: 12px;
    padding: 20px;
    height: calc(100vh - 40px);
    box-sizing: border-box;
}

.tile {
    background: #1b1424;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: transform .35s, box-shadow .35s;
    border: 1.5px solid rgba(150,80,255,0.4);
    box-shadow: 0 0 10px rgba(110,60,255,0.3);
}

/* glowing purple→cerulean gradient frame */
.tile::before {
    content:"";
    position:absolute;
    inset:0;
    border-radius: inherit;
    pointer-events:none;
    background: linear-gradient(135deg,
        rgba(140,70,255,0.7),
        rgba(80,120,255,0.7)
    );
    mask: 
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
    mask-composite: exclude;
    padding:2px;
    opacity:.25;
}

.tile:hover {
    transform: scale(1.03);
    box-shadow: 0 0 14px rgba(120,80,255,0.55);
}

.tile img {
    width:100%; height:100%;
    object-fit: cover;
    filter: brightness(.82);
    transition: filter .4s;
}

.tile:hover img {
    filter: brightness(.95);
}

/* ------------------------------------------------------
   POPUP WINDOWS
   ------------------------------------------------------ */

.popupBG {
    position: fixed;
    inset:0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(4px);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:3000;
}

.popup {
    background:#1b1325;
    border:1.5px solid rgba(150,80,255,0.55);
    border-radius:10px;
    padding:20px;
    width:380px;
    max-width:90%;
    animation: popupIn .55s ease;
    color:#eee;
    box-shadow:0 0 15px rgba(120,70,255,0.5);
    font-family:"ChimeraGoth";
}

@keyframes popupIn {
    0% { transform:scale(.7); opacity:0; }
    100% { transform:scale(1); opacity:1; }
}

.popup button {
    margin-top:14px;
    padding:8px 18px;
    background:#3c2360;
    color:#fff;
    border:1px solid #6940c7;
    border-radius:6px;
    cursor:pointer;
    transition:background .3s;
    font-family:"ChimeraSans";
}
.popup button:hover {
    background:#52308a;
}

/* ------------------------------------------------------
   UMBRELLA RUNE — INVENTORY BUTTON
   ------------------------------------------------------ */

#umbrellaRune {
    position: fixed;
    right: 0;
    top: 45%;
    width: 40px;
    height: 80px;
    background: url('data:image/svg+xml;base64,INSERT_UMBRELLA_ICON_CLOSED_HERE') no-repeat center/contain;
    cursor: pointer;
    opacity: .75;
    filter: drop-shadow(0 0 4px rgba(140,70,255,0.6));
    transition: opacity .3s, transform .3s, filter .4s;
    z-index:2000;
}

#umbrellaRune:hover {
    opacity: 1;
    transform: translateX(-4px);
    filter: drop-shadow(0 0 7px rgba(150,80,255,0.8));
}

/* When drawer is opened — umbrella opens */
.umbrellaOpen {
    background-image: url('data:image/svg+xml;base64,INSERT_UMBRELLA_ICON_OPEN_HERE') !important;
}

/* ------------------------------------------------------
   INVENTORY DRAWER (Velvet Purple)
   ------------------------------------------------------ */

#inventoryDrawer {
    position: fixed;
    right: -360px;
    top:0;
    width: 360px;
    height:100vh;
    background: #190f27;
    background-image: url('data:image/png;base64,INSERT_VELVET_TEXTURE_HERE');
    background-size: cover;
    box-shadow: -4px 0 12px rgba(80,30,150,0.6);
    border-left: 2px solid rgba(140,70,255,0.5);
    padding: 20px;
    color:#eee;
    transition: right .55s ease;
    z-index:2500;
    overflow-y: auto;
}

#inventoryDrawer h2 {
    font-family:"ChimeraGoth";
    font-size: 1.6em;
    margin-top:0;
    color:#d3c8ff;
}

/* Inventory item block */
.invItem {
    border-bottom:1px solid rgba(200,160,255,0.2);
    padding:10px 0;
}

.invItemTitle {
    font-size:1.1em;
    color:#cbb7ff;
}

/* ------------------------------------------------------
   LOGIN POPUP
   ------------------------------------------------------ */

#loginScreen .popup {
    width: 420px;
}

/* ------------------------------------------------------
   UTILITY BUTTONS
   ------------------------------------------------------ */

.uiButton {
    margin-top:8px;
    display:inline-block;
    background:#2d1d45;
    padding:8px 16px;
    color:#ddd;
    border-radius:6px;
    cursor:pointer;
    border:1px solid rgba(150,80,255,0.6);
    transition: background .3s;
}
.uiButton:hover {
    background:#442a6e;
}

/* ------------------------------------------------------
   VOLUME + MUTE BUTTON
   ------------------------------------------------------ */

#soundControls {
    position: fixed;
    bottom: 8px;
    left: 8px;
    z-index:2600;
    display:flex;
    align-items:center;
    gap:10px;
}

#muteBtn {
    padding:6px 12px;
    background:#281b40;
    border:1px solid rgba(150,80,255,0.6);
    border-radius:6px;
    color:#eee;
    cursor:pointer;
}
#volumeSlider {
    width:120px;
}

/* ------------------------------------------------------
   FADE TRANSITION FOR EXTERNAL LINKS
   ------------------------------------------------------ */

.fadeMystery {
    animation: fadeMystery .9s forwards;
}

@keyframes fadeMystery {
    0% { opacity:0; background:rgba(0,0,0,0); }
    100% { opacity:1; background:rgba(0,0,0,0.9); }
}

</style>
</head>
<body>

<!-- ------------------------------------------------------
     LOGIN SCREEN
------------------------------------------------------ -->
<div id="loginScreen" class="popupBG" style="display:flex;">
    <div class="popup">
        <h2>Welcome to Chimera Café</h2>
        <p>Enter your gamer name to begin your journey:</p>
        <input id="usernameInput" type="text" style="width:95%; padding:8px; background:#281d3f; border:1px solid #6c3aff; color:#fff;">
        <button onclick="loginUser()">Enter</button>
    </div>
</div>

<!-- ------------------------------------------------------
     LOGOUT BUTTON
------------------------------------------------------ -->
<div id="logoutBtn" class="uiButton" style="position:fixed; top:8px; left:8px; z-index:2600; display:none;" onclick="logoutUser()">
    Log Out
</div>

<!-- ------------------------------------------------------
     SOUND CONTROLS
------------------------------------------------------ -->
<div id="soundControls">
    <button id="muteBtn" onclick="toggleMute()">Mute</button>
    <input id="volumeSlider" type="range" min="0" max="1" step="0.01" onchange="changeVolume(this.value)">
</div>

<!-- ------------------------------------------------------
     UMBRELLA RUNE — INVENTORY TOGGLE
------------------------------------------------------ -->
<div id="umbrellaRune" onclick="toggleInventory()"></div>

<!-- ------------------------------------------------------
     INVENTORY DRAWER
------------------------------------------------------ -->
<div id="inventoryDrawer">
    <h2>Inventory</h2>
    <div id="inventoryContent">
        <!-- JS will populate inventory items here -->
    </div>
</div>

<!-- ------------------------------------------------------
     GAME GRID — 36 TILES
------------------------------------------------------ -->
<div id="gameGrid">

    <!-- Tiles 1–36 -->
    <!-- IMPORTANT: You will assign thumbnail images in Part 3 -->
    <!-- The data-id attribute will allow routing to special functions -->

    <!-- Row 1 -->
    <div class="tile" data-id="1" onclick="tileAction(1)"></div>
    <div class="tile" data-id="2" onclick="tileAction(2)"></div>
    <div class="tile" data-id="3" onclick="tileAction(3)"></div>
    <div class="tile" data-id="4" onclick="tileAction(4)"></div>
    <div class="tile" data-id="5" onclick="tileAction(5)"></div>
    <div class="tile" data-id="6" onclick="tileAction(6)"></div>

    <!-- Row 2 -->
    <div class="tile" data-id="7" onclick="tileAction(7)"></div>
    <div class="tile" data-id="8" onclick="tileAction(8)"></div>
    <div class="tile" data-id="9" onclick="tileAction(9)"></div>
    <div class="tile" data-id="10" onclick="tileAction(10)"></div>
    <div class="tile" data-id="11" onclick="tileAction(11)"></div>
    <div class="tile" data-id="12" onclick="tileAction(12)"></div>

    <!-- Row 3 -->
    <div class="tile" data-id="13" onclick="tileAction(13)"></div>
    <div class="tile" data-id="14" onclick="tileAction(14)"></div>
    <div class="tile" data-id="15" onclick="tileAction(15)"></div>
    <div class="tile" data-id="16" onclick="tileAction(16)"></div>
    <div class="tile" data-id="17" onclick="tileAction(17)"></div>
    <div class="tile" data-id="18" onclick="tileAction(18)"></div>

    <!-- Row 4 -->
    <div class="tile" data-id="19" onclick="tileAction(19)"></div>
    <div class="tile" data-id="20" onclick="tileAction(20)"></div>
    <div class="tile" data-id="21" onclick="tileAction(21)"></div>
    <div class="tile" data-id="22" onclick="tileAction(22)"></div>
    <div class="tile" data-id="23" onclick="tileAction(23)"></div>
    <div class="tile" data-id="24" onclick="tileAction(24)"></div>

    <!-- Row 5 -->
    <div class="tile" data-id="25" onclick="tileAction(25)"></div>
    <div class="tile" data-id="26" onclick="tileAction(26)"></div>
    <div class="tile" data-id="27" onclick="tileAction(27)"></div>
    <div class="tile" data-id="28" onclick="tileAction(28)"></div>
    <div class="tile" data-id="29" onclick="tileAction(29)"></div>
    <div class="tile" data-id="30" onclick="tileAction(30)"></div>

    <!-- Row 6 -->
    <div class="tile" data-id="31" onclick="tileAction(31)"></div>
    <div class="tile" data-id="32" onclick="tileAction(32)"></div>
    <div class="tile" data-id="33" onclick="tileAction(33)"></div>
    <div class="tile" data-id="34" onclick="tileAction(34)"></div>
    <div class="tile" data-id="35" onclick="tileAction(35)"></div>
    <div class="tile" data-id="36" onclick="tileAction(36)"></div>

</div>

<!-- ------------------------------------------------------
     UNIVERSAL POPUP HANDLER
------------------------------------------------------ -->
<div id="popupWrapper" class="popupBG">
    <div id="popupWindow" class="popup"></div>
</div>

<!-- ------------------------------------------------------
     CHAT WINDOWS
------------------------------------------------------ -->

<!-- Star (Gothic Owner) -->
<div id="starChat" class="popupBG">
    <div class="popup" id="starChatBox"></div>
</div>

<!-- Hans (Tea Snob) -->
<div id="hansChat" class="popupBG">
    <div class="popup" id="hansChatBox"></div>
</div>

<!-- Milo (Zen Taoist Christian) -->
<div id="miloChat" class="popupBG">
    <div class="popup" id="miloChatBox"></div>
</div>

<!-- Miki (Musician Riddle Master) -->
<div id="mikiChat" class="popupBG">
    <div class="popup" id="mikiChatBox"></div>
</div>

<!-- Chari (Quiet Anxious Youngest) -->
<div id="chariChat" class="popupBG">
    <div class="popup" id="chariChatBox"></div>
</div>

<!-- ------------------------------------------------------
     CODEX
------------------------------------------------------ -->
<div id="codexWindow" class="popupBG">
    <div class="popup" style="width:500px;" id="codexContent"></div>
</div>

<!-- ------------------------------------------------------
     LORE VIEWER
------------------------------------------------------ -->
<div id="loreWindow" class="popupBG">
    <div class="popup" style="width:500px;" id="loreContent"></div>
</div>

<!-- ------------------------------------------------------
     CAFÉ MENU (BREWING)
------------------------------------------------------ -->
<div id="cafeMenu" class="popupBG">
    <div class="popup" style="width:420px;" id="cafeMenuBox"></div>
</div>

<!-- ------------------------------------------------------
     MUSIC ROOM (LOCKED UNTIL MIKI RIDDLE)
------------------------------------------------------ -->
<div id="musicRoom" class="popupBG">
    <div class="popup" style="width:480px;" id="musicRoomBox"></div>
</div>

<!-- ------------------------------------------------------
     ENLIGHTENMENT REALM (MILO)
------------------------------------------------------ -->
<div id="enlightenmentRealm" class="popupBG">
    <div class="popup" style="width:480px;" id="enlightenmentBox"></div>
</div>

<!-- ------------------------------------------------------
     SECRET PAGES
------------------------------------------------------ -->
<div id="secretPage" class="popupBG">
    <div class="popup" style="width:480px;" id="secretPageBox"></div>
</div>

<!-- ------------------------------------------------------
     IMPORTANT: PART 3 (FULL JS) WILL GO BELOW THIS LINE
------------------------------------------------------ -->
<script>

/* ======================================================
    GLOBAL GAME STATE
====================================================== */

let gameState = {
    loggedIn: false,
    username: "",
    mute:false,
    volume:0.4,

    progress:{
        metStar:false,
        metHans:false,
        metMilo:false,
        solvedMiki:false,
        metChari:false,
        unlockedMusic:false,
        unlockedEnlightenment:false,
        inventory:[],
        codex:[]
    }
};

/* ======================================================
    SAVE / LOAD
====================================================== */

function saveGame(){
    localStorage.setItem("chimeraCafeSave", JSON.stringify(gameState));
}

function loadGame(){
    let data = localStorage.getItem("chimeraCafeSave");
    if(data){
        try { gameState = JSON.parse(data); } catch(e){}
    }
}

loadGame();

/* ======================================================
    LOGIN / LOGOUT
====================================================== */

function loginUser(){
    let name = document.getElementById("usernameInput").value.trim();
    if(!name) return;

    gameState.loggedIn = true;
    gameState.username = name;
    saveGame();

    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("logoutBtn").style.display = "inline-block";
}

function logoutUser(){
    localStorage.removeItem("chimeraCafeSave");
    location.reload();
}

/* ======================================================
    SOUND SYSTEM
====================================================== */

let windChime = new Audio("data:audio/mp3;base64,INSERT_BASE64_CHIME");

windChime.volume = gameState.volume;

function playChime(){
    if(!gameState.mute){
        windChime.currentTime = 0;
        windChime.play();
    }
}

function toggleMute(){
    gameState.mute = !gameState.mute;
    saveGame();
    document.getElementById("muteBtn").innerText = gameState.mute ? "Unmute" : "Mute";
}

function changeVolume(v){
    gameState.volume = v;
    windChime.volume = v;
    saveGame();
}

/* ======================================================
    POPUP SYSTEM
====================================================== */

function openPopup(title, html){
    let wrap = document.getElementById("popupWrapper");
    let win = document.getElementById("popupWindow");
    win.innerHTML = `<h2>${title}</h2>${html}<br><button onclick="closePopup()">Close</button>`;
    wrap.style.display = "flex";
}

function closePopup(){
    document.getElementById("popupWrapper").style.display = "none";
}

/* ======================================================
    INVENTORY SYSTEM
====================================================== */

function toggleInventory(){
    let drawer = document.getElementById("inventoryDrawer");
    let rune = document.getElementById("umbrellaRune");

    playChime();

    if(drawer.style.right === "0px"){
        drawer.style.right = "-360px";
        rune.classList.remove("umbrellaOpen");
    } else {
        drawer.style.right = "0px";
        rune.classList.add("umbrellaOpen");
        refreshInventory();
    }
}

function addItem(itemName, desc){
    gameState.progress.inventory.push({name:itemName, desc});
    saveGame();
    refreshInventory();
}

function refreshInventory(){
    let cont = document.getElementById("inventoryContent");
    cont.innerHTML = "";
    gameState.progress.inventory.forEach(it=>{
        cont.innerHTML += `
            <div class="invItem">
                <div class="invItemTitle">${it.name}</div>
                <div>${it.desc}</div>
            </div>
        `;
    });
}

/* ======================================================
    TILE THUMBNAIL SYSTEM
====================================================== */

const thumbnails = {
    star:"images/star.png",
    hans:"images/hans.png",
    milo:"images/milo.png",
    miki:"images/miki.png",
    chari:"images/chari.png",

    cafe:"images/cafe.png",
    cafeInterior:"images/cafeInterior.png",
    loreHall:"images/loreHall.png",
    musicDoor:"images/musicDoor.png",
    clue1:"images/clue1.png",
    clue2:"images/clue2.png",
    clue3:"images/clue3.png",
    clue4:"images/clue4.png",

    /* Fill in your own custom images for the rest */
};

function assignThumbnails(){
    let tiles = document.querySelectorAll(".tile");
    tiles.forEach(t=>{
        let id = t.getAttribute("data-id");
        t.innerHTML = `<img src="images/default${id}.jpg">`;
    });

    /* Assign known special ones */
    document.querySelector('.tile[data-id="3"]').innerHTML = `<img src="${thumbnails.hans}">`;
    document.querySelector('.tile[data-id="1"]').innerHTML = `<img src="${thumbnails.star}">`;
    document.querySelector('.tile[data-id="7"]').innerHTML = `<img src="${thumbnails.milo}">`;
    document.querySelector('.tile[data-id="9"]').innerHTML = `<img src="${thumbnails.miki}">`;
    document.querySelector('.tile[data-id="12"]').innerHTML = `<img src="${thumbnails.chari}">`;

    document.querySelector('.tile[data-id="18"]').innerHTML = `<img src="${thumbnails.cafe}">`;
    document.querySelector('.tile[data-id="19"]').innerHTML = `<img src="${thumbnails.cafeInterior}">`;

    document.querySelector('.tile[data-id="6"]').innerHTML = `<img src="${thumbnails.musicDoor}">`;

    document.querySelector('.tile[data-id="22"]').innerHTML = `<img src="${thumbnails.clue1}">`;
    document.querySelector('.tile[data-id="23"]').innerHTML = `<img src="${thumbnails.clue2}">`;
    document.querySelector('.tile[data-id="24"]').innerHTML = `<img src="${thumbnails.clue3}">`;
    document.querySelector('.tile[data-id="25"]').innerHTML = `<img src="${thumbnails.clue4}">`;
}

assignThumbnails();

/* ======================================================
    TILE ACTION ROUTER
====================================================== */

function tileAction(id){
    playChime();
    switch(id){
        case 1: openStarChat(); break;
        case 3: openHansChat(); break;
        case 7: openMiloChat(); break;
        case 9: openMikiChat(); break;
        case 12: openChariChat(); break;

        case 18: openCafeMenu(); break;
        case 19: openCafeMenu(); break;

        case 6: tryMusicRoom(); break;

        case 22:
        case 23:
        case 24:
        case 25:
            openPopup("Clue", "<p>The air hums... someone is watching. Look for the tea snob.</p>");
        break;

        default:
            openPopup("Tile", "<p>This square whispers secrets, but not yet...</p>");
    }
}

/* ======================================================
    STAR CHATBOT
====================================================== */

function openStarChat(){
    gameState.progress.metStar = true;
    saveGame();

    let el = document.getElementById("starChatBox");
    document.getElementById("starChat").style.display = "flex";

    el.innerHTML = `
        <h2>Star</h2>
        <p>Oh… hello ${gameState.username}.  
        Welcome to my café of shadows and soft candlelight.  
        What brings you to this haunted little corner?</p>
        <button onclick="closeStarChat()">Close</button>
    `;
}

function closeStarChat(){
    document.getElementById("starChat").style.display = "none";
}

/* ======================================================
    HANS CHATBOT
====================================================== */

function openHansChat(){
    gameState.progress.metHans = true;
    saveGame();

    let el = document.getElementById("hansChatBox");
    document.getElementById("hansChat").style.display = "flex";

    el.innerHTML = `
        <h2>Hans</h2>
        <p>"Well well well… look what the chimera-cat dragged in.  
        ${gameState.username}, was it?  
        Try not to spill anything this time, mm?"</p>

        <button onclick="hansQ1()">He asks a snarky question</button>
    `;
}

function hansQ1(){
    let el = document.getElementById("hansChatBox");
    el.innerHTML = `
        <h2>Hans</h2>
        <p>"Tell me, ${gameState.username}…  
        Do you actually *like* tea, or are you here to pretend sophistication?"</p>

        <button onclick="hansYes()">Yes</button>
        <button onclick="hansNo()">No</button>
    `;
}

function hansYes(){
    document.getElementById("hansChatBox").innerHTML = `
        <h2>Hans</h2>
        <p>"Marvelous. Finally someone with taste.  
        Here, take this lavender sprig."</p>
        <button onclick="hansGiveTea()">Take Item</button>
    `;
}

function hansNo(){
    document.getElementById("hansChatBox").innerHTML = `
        <h2>Hans</h2>
        <p>"Tragic. Utterly tragic.  
        Still… perhaps I can educate you."</p>

        <button onclick="hansGiveTea()">He sighs and hands you something</button>
    `;
}

function hansGiveTea(){
    addItem("Lavender Sprig", "Hans’s begrudging gift. Smells judgmental.");
    document.getElementById("hansChatBox").innerHTML = `
        <h2>Hans</h2>
        <p>"Try not to lose it."</p>
        <button onclick="closeHansChat()">Close</button>
    `;
}

function closeHansChat(){
    document.getElementById("hansChat").style.display = "none";
}

/* ======================================================
    MILO CHATBOT — ENLIGHTENMENT PATH
====================================================== */

function openMiloChat(){
    gameState.progress.metMilo = true;
    saveGame();

    let el = document.getElementById("miloChatBox");
    document.getElementById("miloChat").style.display = "flex";

    el.innerHTML = `
        <h2>Milo</h2>
        <p>"Peace to you, ${gameState.username}.  
        Sit with me. Let us breathe for a moment."</p>
        <button onclick="miloQ1()">Continue</button>
    `;
}

function miloQ1(){
    let el = document.getElementById("miloChatBox");
    el.innerHTML = `
        <h2>Milo</h2>
        <p>"Do you seek understanding?"</p>
        <button onclick="miloYes()">Yes</button>
        <button onclick="miloNo()">No</button>
    `;
}

function miloYes(){
    document.getElementById("miloChatBox").innerHTML = `
        <h2>Milo</h2>
        <p>"Then breathe deeply. A path will open."</p>
        <button onclick="openEnlightenmentRealm()">Enter Realm</button>
    `;
}

function miloNo(){
    document.getElementById("miloChatBox").innerHTML = `
        <h2>Milo</h2>
        <p>"Even no is a path. When you're ready, return."</p>
        <button onclick="closeMiloChat()">Close</button>
    `;
}

function closeMiloChat(){
    document.getElementById("miloChat").style.display = "none";
}

function openEnlightenmentRealm(){
    gameState.progress.unlockedEnlightenment = true;
    saveGame();

    document.getElementById("miloChat").style.display = "none";
    let el = document.getElementById("enlightenmentBox");
    document.getElementById("enlightenmentRealm").style.display = "flex";

    el.innerHTML = `
        <h2>The Realm of Light</h2>
        <p>A warm breeze surrounds you…  
        Milo speaks softly:</p>
        <p>"Salvation is offered freely by Yeshua.  
        Romans 10:9 — If you declare with your mouth,  
        'Jesus is Lord,' and believe in your heart that  
        God raised Him from the dead, you will be saved."</p>

        <button onclick="closeEnlightenment()">Return</button>
    `;
}

function closeEnlightenment(){
    document.getElementById("enlightenmentRealm").style.display = "none";
}

/* ======================================================
    MIKI — RIDDLE / MUSIC UNLOCK
====================================================== */

function openMikiChat(){
    let el = document.getElementById("mikiChatBox");
    document.getElementById("mikiChat").style.display = "flex";

    if(!gameState.progress.solvedMiki){
        el.innerHTML = `
            <h2>Miki</h2>
            <p>"Yo ${gameState.username}!  
               Wanna unlock my tracks? Prove you’re sharp."</p>
            <button onclick="mikiRiddle1()">Start Riddle</button>
        `;
    } else {
        el.innerHTML = `
            <h2>Miki</h2>
            <p>"You already solved my riddles.  
            Music room's open."</p>
            <button onclick="tryMusicRoom()">Go to Music Room</button>
        `;
    }
}

function mikiRiddle1(){
    let el = document.getElementById("mikiChatBox");
    el.innerHTML = `
        <h2>Miki</h2>
        <p>"Riddle 1:  
        I have keys but open no doors.  
        What am I?"</p>

        <button onclick="mikiCheck('piano')">Piano</button>
        <button onclick="mikiCheck('lock')">A Lock</button>
    `;
}

function mikiCheck(ans){
    if(ans === 'piano'){
        gameState.progress.solvedMiki = true;
        saveGame();
        document.getElementById("mikiChatBox").innerHTML = `
            <h2>Miki</h2>
            <p>"Yesss! You nailed it!  
            Music room unlocked!"</p>
            <button onclick="closeMikiChat()">Nice</button>
        `;
    } else {
        document.getElementById("mikiChatBox").innerHTML = `
            <h2>Miki</h2>
            <p>"Nope. Try again."</p>
            <button onclick="mikiRiddle1()">Retry</button>
        `;
    }
}

function closeMikiChat(){
    document.getElementById("mikiChat").style.display = "none";
}

/* MUSIC ROOM */
function tryMusicRoom(){
    if(!gameState.progress.solvedMiki){
        openPopup("Locked", "<p>Miki hums from afar… solve her riddle first.</p>");
        return;
    }

    document.getElementById("musicRoom").style.display = "flex";
    document.getElementById("musicRoomBox").innerHTML = `
        <h2>Miki's Tracks</h2>
        <p>Choose a track to play.</p>

        <audio controls>
            <source src="music/track1.mp3" type="audio/mp3">
        </audio><br>

        <audio controls>
            <source src="music/track2.mp3" type="audio/mp3">
        </audio><br>

        <button onclick="closeMusicRoom()">Close</button>
    `;
}

function closeMusicRoom(){
    document.getElementById("musicRoom").style.display = "none";
}

/* ======================================================
    CHARI — SOFT CHAT
====================================================== */

function openChariChat(){
    gameState.progress.metChari = true;
    saveGame();

    let el
